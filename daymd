#!/usr/local/bin/bash
option="eventsToday"
if [ ! -z "$1" ]; then
    option="eventsFrom:$1 to:$1"
fi

/usr/local/bin/icalBuddyFixed -b '' -npn -nc -ps "/ | /" -eep "notes,attendees,url" $option | \
    /usr/local/bin/awk -F\| '
{
    if (NF>2) {
        gsub(/ /,"",$3);
        printf("- `%s`  %s %s\n", $3, $1, $2);
    } else if (NF==1) {
        printf("- %s\n", $1);
    } else {
        gsub(/ /,"",$2);
        printf("- `%s`  %s\n", $2, $1);
    }
}
' | /usr/local/opt/gnu-sed/libexec/gnubin/sed 's/\(https:\/\/[^ ]*\)/[zoom](\1)/'
